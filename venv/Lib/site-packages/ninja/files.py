<<<<<<< HEAD
from typing import Any, Callable, Dict, Iterable, Optional, Type

from django.core.files.uploadedfile import UploadedFile as DjangoUploadedFile
from pydantic.fields import ModelField
=======
from typing import Any, Callable, Dict

from django.core.files.uploadedfile import UploadedFile as DjangoUploadedFile
from pydantic_core import core_schema
>>>>>>> ecbd90b (Initial commit)

__all__ = ["UploadedFile"]


class UploadedFile(DjangoUploadedFile):
    @classmethod
<<<<<<< HEAD
    def __get_validators__(cls: Type["UploadedFile"]) -> Iterable[Callable[..., Any]]:
        yield cls._validate

    @classmethod
    def _validate(cls: Type["UploadedFile"], v: Any) -> Any:
=======
    def __get_pydantic_json_schema__(
        cls, core_schema: Any, handler: Callable[..., Any]
    ) -> Dict:
        # calling handler(core_schema) here raises an exception
        json_schema: Dict[str, str] = {}
        json_schema.update(type="string", format="binary")
        return json_schema

    @classmethod
    def _validate(cls, v: Any, _: Any) -> Any:
>>>>>>> ecbd90b (Initial commit)
        if not isinstance(v, DjangoUploadedFile):
            raise ValueError(f"Expected UploadFile, received: {type(v)}")
        return v

    @classmethod
<<<<<<< HEAD
    def __modify_schema__(
        cls, field_schema: Dict[str, Any], field: Optional[ModelField] = None
    ) -> None:
        field_schema.update(type="string", format="binary")
=======
    def __get_pydantic_core_schema__(
        cls, source: Any, handler: Callable[..., Any]
    ) -> Any:
        return core_schema.with_info_plain_validator_function(cls._validate)
>>>>>>> ecbd90b (Initial commit)
