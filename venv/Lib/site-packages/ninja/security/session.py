from typing import Any, Optional

from django.conf import settings
from django.http import HttpRequest

from ninja.security.apikey import APIKeyCookie

<<<<<<< HEAD
<<<<<<< HEAD
__all__ = ["SessionAuth", "SessionAuthSuperUser"]
=======
__all__ = ["SessionAuth", "SessionAuthSuperUser", "SessionAuthIsStaff"]
>>>>>>> ecbd90b (Initial commit)
=======
__all__ = ["SessionAuth", "SessionAuthSuperUser"]
>>>>>>> 903c694 (inital commit)


class SessionAuth(APIKeyCookie):
    "Reusing Django session authentication"
<<<<<<< HEAD
<<<<<<< HEAD
=======

>>>>>>> ecbd90b (Initial commit)
=======
>>>>>>> 903c694 (inital commit)
    param_name: str = settings.SESSION_COOKIE_NAME

    def authenticate(self, request: HttpRequest, key: Optional[str]) -> Optional[Any]:
        if request.user.is_authenticated:
            return request.user

        return None


class SessionAuthSuperUser(APIKeyCookie):
    "Reusing Django session authentication & verify that the user is a super user"
<<<<<<< HEAD
<<<<<<< HEAD
=======

>>>>>>> ecbd90b (Initial commit)
=======
>>>>>>> 903c694 (inital commit)
    param_name: str = settings.SESSION_COOKIE_NAME

    def authenticate(self, request: HttpRequest, key: Optional[str]) -> Optional[Any]:
        is_superuser = getattr(request.user, "is_superuser", None)
        if request.user.is_authenticated and is_superuser:
            return request.user

        return None
<<<<<<< HEAD
<<<<<<< HEAD
=======


class SessionAuthIsStaff(SessionAuthSuperUser):
    def authenticate(self, request: HttpRequest, key: Optional[str]) -> Optional[Any]:
        result = super().authenticate(request, key)
        if result is not None:
            return result
        if request.user.is_authenticated and getattr(request.user, "is_staff", None):
            return request.user

        return None
>>>>>>> ecbd90b (Initial commit)
=======
>>>>>>> 903c694 (inital commit)
